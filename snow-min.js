(()=>{function B(){let t={},n=document.currentScript;return n&&n.src&&new URL(n.src).searchParams.forEach((e,r)=>{t[r]=e}),t}async function V(t){let n=await fetch(`https://ijgyqpqtsauyluefxvvb.supabase.co/functions/v1/get-config?token=${t}`,{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlqZ3lxcHF0c2F1eWx1ZWZ4dnZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMxMDMyMTcsImV4cCI6MjA1ODY3OTIxN30.fn6Uc1EWGeMbGufBQWQzCLHFSI_ElmA8-ZjOMJL2raM"}});if(!n.ok){if(n.status===403)return console.error("Abonnement inactif ou expir\xE9. Veuillez renouveler votre abonnement."),null;throw console.error("R\xE9ponse API non valide :",n.status,n.statusText),new Error("Failed to fetch configuration")}let a=await n.json();return console.log("Donn\xE9es API :",a),a}async function O(t){let n=B(),a;if(n.preview==="true"&&n.config)a=JSON.parse(decodeURIComponent(n.config));else if(n.token)try{if(a=await V(n.token),!a)return console.error("Impossible de charger la configuration : abonnement invalide."),t}catch(e){return console.error("Erreur lors de la r\xE9cup\xE9ration de la configuration :",e),t}else return console.error("Aucun token ou configuration preview fourni"),t;return{...t,...a}}var o,C;function L(t){o=document.getElementById("snowCanvas")||null,o||(o=document.createElement("canvas"),o.id="snowCanvas",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.pointerEvents="none",o.style.zIndex=t.zIndex,document.body.appendChild(o)),o.width=window.innerWidth,o.height=window.innerHeight,C=o.getContext("2d",{alpha:!0})}function w(t,n,a){let e=Math.floor(Math.random()*t.length),r=Math.random()*a.width,h=-n.flakeSize;if(t.length>0&&Math.random()<.3){let f=t[e].getBoundingClientRect(),u=f.top+window.scrollY;u>window.scrollY+window.innerHeight&&(r=f.left+Math.random()*f.width,h=Math.max(window.scrollY-n.flakeSize,u-Math.random()*200-50))}return{x:r,y:h,vX:(Math.random()-.5)*n.maxHorizontalSpeed,vY:Math.random()*n.maxVerticalSpeed,active:!0,accumule:!1,meltFrame:0,twinkleFrame:0,h1Cible:e,offsetX:0,offsetY:0,lastY:h,color:n.flakeColors[Math.floor(Math.random()*n.flakeColors.length)],rayon:n.flakeSize*(1+(Math.random()-.5)*n.sizeVariation)}}function Y(t,n,a,e){if(n.accumule){let h=e.indexOf(n);h!==-1&&e.splice(h,1),n.accumule=!1}let r=a();Object.assign(n,{x:r.x,y:r.y,vX:(Math.random()-.5)*t.maxHorizontalSpeed,vY:Math.random()*t.maxVerticalSpeed+1,rayon:t.flakeSize*(1+(Math.random()-.5)*t.sizeVariation),active:!0,meltFrame:0,twinkleFrame:0,h1Cible:r.h1Index,lastY:r.y,color:t.flakeColors[Math.floor(Math.random()*t.flakeColors.length)]})}var D=(t,n,a,e,r)=>{a.fillStyle=t.color,r.flakeShape==="default"?(a.beginPath(),a.arc(t.x,n,t.rayon,0,Math.PI*2),a.fill()):r.flakeShape==="custom"&&a.drawImage(e,t.x-t.rayon,n-t.rayon,t.rayon*2,t.rayon*2)},W=t=>{let n=document.createElement("canvas"),a=20;n.width=a,n.height=a;let e=n.getContext("2d");return e.font=`${a}px Arial`,e.fillText(t.emojiCharacter,0,a-5),n},F=null;function H(t,n,a,e,r,h,m,f,u,k,v){a.flakeShape==="custom"&&!F&&(F=W(a)),m.clearRect(0,0,f.width,f.height),m.globalAlpha=a.opacity;let d=window.scrollY,x=d+window.innerHeight,I={top:d-100,bottom:x+100},z=1e3;for(;n.length>z;)n.shift();let g=n.filter(c=>c.y>=I.top&&c.y<=I.bottom),y=[];for(let c=0;c<t.length;c++){let i=t[c];i.active&&!i.accumule&&(i.lastY=i.y,i.x+=i.vX*u,i.y+=i.vY,i.y>v||i.x<-50||i.x>f.width+50?r(a,i,h,n):(i.y>=I.top&&i.y<=I.bottom&&y.push(i),a.meltEffects&&Math.random()>.998&&(i.meltFrame=1),i.meltFrame>0&&(i.rayon-=.2,i.meltFrame++,i.rayon<=0&&r(a,i,h,n))))}for(let c=0;c<y.length;c++)D(y[c],y[c].y-d,m,F,a);for(let c=0;c<g.length;c++)D(g[c],g[c].y-d,m,F,a);requestAnimationFrame(()=>H(t,n,a,e,r,h,m,f,u,k,v))}function A(t){if(!t)return!0;let n=new Date,a=t.startDate?new Date(t.startDate):null,e=t.endDate?new Date(t.endDate):null;return a&&e?n>=a&&n<=e:a?n>=a:e?n<=e:!0}window.snowStorm=function(t,n){let a={opacity:1,maxFlakes:200,flakeColors:["#fff","#ececf2","#7792a7","#e7eaef","#bfcbd3"],flakeShape:"default",emojiCharacter:"\u2744\uFE0F",flakeSize:2,sizeVariation:1,autoStart:!0,maxHorizontalSpeed:1.5,maxVerticalSpeed:1.5,mouseInteraction:!1,stickyEffect:!1,meltEffects:!0,startDate:null,endDate:null,disableOnMobile:!0,useGPU:!0,zIndex:9999},e={...a},r=[],h,m=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),f=1,u=[],k=[],v=0;function d(l){let s=A(l),p=l.autoStart===!0,M=!l.disableOnMobile||!m;return s&&p&&M}(async function(){e=await O(a),console.group("%c loadConfig","color: white; background-color:rgb(164, 27, 27); font-size: 15px"),console.log({IS_WITHIN_LIFETIME:A(e),AUTO_START:e.autoStart,DISABLE_ON_MOBILE:e.disableOnMobile,IS_MOBILE:m,SHOULD_START:d(e)}),console.groupEnd(),d(e)&&S()})();function x(){u=Array.from(n.querySelectorAll("h1")),v=Math.max(n.body.scrollHeight,n.documentElement.scrollHeight,n.body.offsetHeight,n.documentElement.offsetHeight)}function I(l){return!1}function z(){if(Math.random()<.7||u.length===0)return{x:Math.random()*o.width,y:-e.flakeSize,h1Index:Math.floor(Math.random()*Math.max(1,u.length))};{let s=Math.floor(Math.random()*u.length),M=u[s].getBoundingClientRect(),X=M.top+t.scrollY;return{x:M.left+Math.random()*M.width,y:Math.max(-e.flakeSize,X-Math.random()*200-50),h1Index:s}}}function g(){x(),r=[],k=[];for(let l=0;l<e.maxFlakes;l++){let s=w(u,e,o);l<e.maxFlakes/3&&(s.y=Math.random()*v),r.push(s)}}function y(){r.forEach(l=>{l.size=e.flakeSize+Math.random()*e.sizeVariation,l.color=e.flakeColors[Math.floor(Math.random()*e.flakeColors.length)],l.vX=Math.random()*e.maxHorizontalSpeed*2-e.maxHorizontalSpeed,l.vY=Math.random()*e.maxVerticalSpeed+.5})}function c(){let l=r.length;if(e.maxFlakes>l)for(let s=l;s<e.maxFlakes;s++){let p=w(u,e,o);r.push(p)}else e.maxFlakes<l&&(r=r.slice(0,e.maxFlakes))}function i(){o.width=t.innerWidth,o.height=t.innerHeight,x()}function b(l){e.mouseInteraction&&r.forEach(s=>{if(s.active&&!s.accumule){let p=l.clientX-s.x;s.vX+=p*.01,s.vX=Math.max(-e.maxHorizontalSpeed,Math.min(e.maxHorizontalSpeed,s.vX))}})}function S(){e.disableOnMobile&&m||h||(o?(o.width=t.innerWidth,o.height=t.innerHeight):L(e),x(),g(),H(r,k,e,I,Y,z,C,o,f,u,v),t.addEventListener("resize",i),t.addEventListener("scroll",x),e.mouseInteraction&&t.addEventListener("mousemove",b))}function E(){o&&(o.width=t.innerWidth,o.height=t.innerHeight,C.clearRect(0,0,o.width,o.height)),cancelAnimationFrame(h),h=null,t.removeEventListener("resize",i),t.removeEventListener("scroll",x),e.mouseInteraction&&t.removeEventListener("mousemove",b)}function T(){E(),S()}function R(l){let s={...e};e={...e,...l};let p=d(e),M=!!h;if(!p){E();return}if(!M){S();return}y(),e.maxFlakes!==s.maxFlakes&&c(),e.mouseInteraction!==s.mouseInteraction&&(e.mouseInteraction?t.addEventListener("mousemove",b):t.removeEventListener("mousemove",b))}return{start:S,stop:E,restart:T,updateConfig:R,get config(){return e}}}(window,document);})();
